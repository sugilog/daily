<div class="page-header">
  <h1>
    <%= start_date.year %>.<%= start_date.month %>: <%= @topic.title %>
    <small>
      <%= @topic.description %>
    </small>
  </h1>
</div>


<%= link_to t('.edit', :default => t("helpers.links.edit")),
            edit_user_topic_path(current_user, @topic), :class => 'btn' %>
<%= link_to t('.destroy', :default => t("helpers.links.destroy")),
            user_topic_path(current_user, @topic),
            :method => 'delete',
            :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
            :class => 'btn btn-danger' %>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
  var chartData = <%== ( [['day', 'score']] + @dailylogs.map{|date, dailylog| [date.mday, dailylog.score.to_i] } ).to_json %>;
</script>
<script type="text/javascript">
  google.load("visualization", "1", {packages:["corechart"]});
  function drawChart(_data) {
    var data = google.visualization.arrayToDataTable(_data);
    var chart = new google.visualization.LineChart(jQuery("#chart_div").get(0));
    chart.draw(data);
  }
  google.setOnLoadCallback(function() {
    drawChart(chartData);
    jQuery(window).on("resize", function() { drawChart(chartData); });
    jQuery(document).on("page:load", function() { drawChart(chartData); });
  });
</script>
<div class="row">
<div id="chart_div" class="span12" style="height: 200px;"></div>
</div>


<ul class="pager">
  <li class="previous">
  <%= link_to user_topic_dailylogs_path(current_user, @topic, year: start_date.prev_month.year, month: start_date.prev_month.month) do %>
    &larr; Previous
  <% end %>
  </li>
  <li class="next">
  <%= link_to user_topic_dailylogs_path(current_user, @topic, year: start_date.next_month.year, month: start_date.next_month.month) do %>
    Next &rarr;
  <% end %>
  </li>
</ul>

<ul class="nav nav-tabs nav-stacked">
  <%
    @dailylogs.each do |date, dailylog|
      link_path = dailylog.new_record? ?
        new_user_topic_dailylog_path(current_user, @topic, logged_on: date) :
        edit_user_topic_dailylog_path(current_user, @topic, dailylog)
  %>
  <li>
  <%= link_to link_path do %>
    <%=l date %>
    <%= content_tag :span, dailylog.score, class: "badge" %>
    <% if dailylog.memo.present? %>
      (<%= content_tag :small, (dailylog.memo) %>)
    <% end %>
  <% end %>
  </li>
  <% end %>
</ul>

<ul class="pager">
  <li class="previous">
  <%= link_to user_topic_dailylogs_path(current_user, @topic, year: start_date.prev_month.year, month: start_date.prev_month.month) do %>
    &larr; Previous
  <% end %>
  </li>
  <li class="next">
  <%= link_to user_topic_dailylogs_path(current_user, @topic, year: start_date.next_month.year, month: start_date.next_month.month) do %>
    Next &rarr;
  <% end %>
  </li>
</ul>
